<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Week {{ week_num }} - Learning Journey</title>
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(135deg,#f4e1ff,#ffe6f9,#fff);
      margin: 0;
      padding: 0;
    }
    header {
      background: linear-gradient(90deg,#9a57ff,#ff73d9);
      color:#fff;
      padding:15px 25px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight:500;
      box-shadow:0 4px 15px rgba(166,66,255,0.3);
    }
    .container {
      max-width:950px;
      margin:50px auto;
      background:#fff;
      border-radius:25px;
      padding:40px;
      box-shadow:0 8px 30px rgba(160,60,255,0.15);
      text-align:center;
    }
    h1{color:#9a57ff;margin-bottom:10px;font-size:2rem;}
    h2{color:#ff73d9;margin-bottom:30px;font-weight:500;}
    .topic-card{
      background:#faf5ff;
      border-left:6px solid #9a57ff;
      border-radius:15px;
      margin:15px 0;
      padding:20px;
      text-align:left;
      color:#4a1560;
      box-shadow:0 4px 12px rgba(160,60,255,0.1);
      transition:all .3s ease;
    }
    .topic-card:hover{
      transform:translateY(-5px);
      background:#fcecff;
      box-shadow:0 8px 25px rgba(160,60,255,0.2);
    }
    .topic-title{font-size:17px;font-weight:500;margin-bottom:12px;}
    .button-group{display:flex;flex-wrap:wrap;gap:10px;}
    button{
      background:linear-gradient(90deg,#9a57ff,#ff73d9);
      color:#fff;border:none;border-radius:10px;
      padding:8px 16px;cursor:pointer;font-size:14px;
      font-weight:500;transition:all .3s ease;
    }
    button:hover{transform:scale(1.08);box-shadow:0 0 12px rgba(160,60,255,0.4);}
    .progress-bar{
      width:100%;background:#eee0ff;border-radius:10px;
      height:14px;overflow:hidden;margin:30px 0;
    }
    .progress-fill{
      height:100%;
      background:linear-gradient(90deg,#9a57ff,#ff73d9);
      width:0%;transition:width .6s ease;
    }
    .nav-buttons{text-align:center;margin-top:30px;}
    .nav-buttons a{
      background:linear-gradient(90deg,#9a57ff,#ff73d9);
      color:#fff;text-decoration:none;border-radius:12px;
      padding:12px 22px;margin:0 10px;
      transition:all .3s ease;display:inline-block;
    }
    .nav-buttons a:hover{
      transform:scale(1.08);
      box-shadow:0 0 12px rgba(160,60,255,0.4);
    }
    footer{text-align:center;margin-top:40px;color:#777;font-size:14px;}
  </style>
</head>
<body>
<header>
  <div>üìÖ Week {{ week_num }} Plan</div>
  <a href="/dashboard" style="color:white;text-decoration:none;">Back to Dashboard</a>
</header>

<div class="container">
  <h1>Learning Plan - {{ career }}</h1>
  <h2>Topics to be Covered in Week {{ week_num }}</h2>

  {% set topic_list = topics.split(',') if topics is string else topics %}
  {% if topic_list %}
    {% for t in topic_list %}
    <div class="topic-card" id="topic-{{ loop.index }}">
      <div class="topic-title">üîπ {{ t.strip() }}</div>
      <div class="button-group">
        <button class="start-btn" data-topic="{{ t.strip() }}">üöÄ Start</button>
        <button class="complete-btn" data-topic="{{ t.strip() }}">‚úÖ Mark as Completed</button>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <p>No topics found for this week.</p>
  {% endif %}

  <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>

  <div class="nav-buttons">
    <a href="/resources">üìö Go to Resources</a>
    <a href="/quiz?topic={{ career }}">üß† Take Quiz</a>
  </div>
</div>

<footer>‚ú® Keep learning, keep growing ‚Äî you're doing amazing! ‚ú®</footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const startBtns = document.querySelectorAll(".start-btn");
  const completeBtns = document.querySelectorAll(".complete-btn");
  const progressBar = document.getElementById("progress");
  const total = completeBtns.length;
  let completed = 0;

  startBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      const topic = btn.dataset.topic;
      alert(`üöÄ Starting topic: ${topic}`);
    });
  });

  completeBtns.forEach(btn => {
    btn.addEventListener("click", async () => {
      const topic = btn.dataset.topic;
      completed = Math.min(completed + 1, total);
      const percent = (completed / total) * 100;
      progressBar.style.width = percent + "%";

      try {
        const res = await fetch("/api/mark-resource-progress", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            title: `${topic} - Week {{ week_num }}`,
            progress: 100
          })
        });

        const data = await res.json();

        if (data.ok) {
          alert(`üéâ Great job! You completed: ${topic}\nüî• XP added to your dashboard!`);
        } else {
          alert("‚ö†Ô∏è Could not update dashboard, try again later.");
        }

      } catch (err) {
        console.error("Error updating resource progress:", err);
        alert("‚ö†Ô∏è Server error while saving progress.");
      }
    });
  });
});
</script>

</body>
</html>
